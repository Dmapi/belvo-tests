// @observablehq/plot v0.1.0 Copyright 2020-2021 Observable, Inc.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3@6.7.0/dist/d3.min.js")):"function"==typeof define&&define.amd?define(["exports","d3@6.7.0/dist/d3.min.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Plot=t.Plot||{},t.d3)}(this,(function(t,e){"use strict";if("undefined"!=typeof document){const t=document.createElement("style");t.textContent=".plot{display:block;font:10px system-ui,sans-serif;background:#fff;height:auto;height:intrinsic;max-width:100%}.plot text{white-space:pre}",document.head.appendChild(t)}function n(t){if(t instanceof Date||(t=new Date(+t)),isNaN(t))return"Invalid Date";const e=t.getUTCHours(),n=t.getUTCMinutes(),o=t.getUTCSeconds(),i=t.getUTCMilliseconds();return`${a=t.getUTCFullYear(),a<0?`-${r(-a,6)}`:a>9999?`+${r(a,6)}`:r(a,4)}-${r(t.getUTCMonth()+1,2)}-${r(t.getUTCDate(),2)}${e||n||o||i?`T${r(e,2)}:${r(n,2)}${o||i?`:${r(o,2)}${i?`.${r(i,3)}`:""}`:""}Z`:""}`;var a}function r(t,e){return(t+"").padStart(e,"0")}function o(t){return null!=t&&!Number.isNaN(t)}function i(t,n){return o(n)-o(t)||e.ascending(t,n)}function a(t){return null!=t&&t+""!=""}function l(t,...e){for(const n of e)n&&(t=t.filter((t=>o(n[t]))));return t}function s(t){return t>0?t:NaN}function c(t){return t<0?t:NaN}const u=Object.getPrototypeOf(Uint8Array),f=Object.prototype.toString;class d{constructor(t,e=[],n={}){const r=new Set;this.data=t;const{transform:o}=F(n);this.transform=o,this.channels=e.filter((t=>{const{name:e,value:n,optional:o}=t;if(null==n){if(o)return!1;throw new Error(`missing channel value: ${e}`)}if("string"==typeof n&&(t.value=m(n)),void 0!==e){const t=e+"";if("__proto__"===t)throw new Error("illegal channel name");if(r.has(t))throw new Error(`duplicate channel: ${t}`);r.add(t)}return!0}))}initialize(t){let e=L(this.data),n=void 0===t&&null!=e?P(e):t;return void 0!==e&&void 0!==this.transform&&(void 0===t&&(n=n.length?[n]:[]),({facets:n,data:e}=this.transform(e,n)),e=L(e),void 0===t&&n.length&&([n]=n)),{index:n,channels:this.channels.map((t=>{const{name:n}=t;return[null==n?void 0:n+"",p(e,t)]}))}}plot({marks:t=[],...e}={}){return Kt({...e,marks:[...t,this]})}}function p(t,{scale:e,type:n,value:r}){return{scale:e,type:n,value:h(t,r),label:r?r.label:void 0}}function h(t,e,n){const r=void 0===n?Array:n;return"string"==typeof e?r.from(t,m(e)):"function"==typeof e?r.from(t,e):"number"==typeof e||e instanceof Date?r.from(t,O(e)):e&&"function"==typeof e.transform?L(e.transform(t),n):L(e,n)}const m=t=>Object.assign((e=>e[t]),{label:t}),y=(t,e)=>e,g={transform:t=>t},x=t=>null==t?t:t+"",v=t=>null==t?t:+t,k=t=>null==t?t:!!t,b=t=>t[0],w=t=>t[1],O=t=>()=>t,R=new Set(["currentColor","none"]);function B(t,n){return void 0===t&&(t=n),null===t?[void 0,"none"]:"string"==typeof t&&(R.has(t)||e.color(t))?[void 0,t]:[t,void 0]}function M(t,e){return void 0===t&&(t=e),null===t||"number"==typeof t?[void 0,t]:[t,void 0]}function $(t,e,n){if(null!=t)return C(t,e,n)}function C(t,e,n){const r=(t+"").toLowerCase();if(!n.includes(r))throw new Error(`invalid ${e}: ${t}`);return r}function L(t,e){return null==t?t:void 0===e?t instanceof Array||t instanceof u?t:Array.from(t):t instanceof e?t:e.from(t)}function T(t,e,n,r=g){return void 0===e&&void 0===n?(e=0,n=void 0===t?r:t):void 0===e?e=void 0===t?0:t:void 0===n&&(n=void 0===t?0:t),[e,n]}function A(t,e){return void 0===t&&void 0===e?[b,w]:[t,e]}function z({z:t,fill:e,stroke:n}={}){return void 0===t&&([t]=B(e)),void 0===t&&([t]=B(n)),t}function S(t){return t?e=>e.filter((e=>a(t[e]))).append("title").text((e=>t[e])):()=>{}}function Y(t){return t?e=>e.filter((([e])=>a(t[e]))).append("title").text((([e])=>t[e])):()=>{}}function P(t){return Uint32Array.from(t,y)}function N(t,e){return Array.from(e,(e=>t[e]))}function _(t,e){if(void 0!==e[t])return e[t];switch(t){case"x1":case"x2":t="x";break;case"y1":case"y2":t="y"}return e[t]}function j(t){let e;return[{transform:()=>e,label:G(t)},t=>e=t]}function G(t,e){return"string"==typeof t?t:t&&void 0!==t.label?t.label:e}function E(t){return null==t?[t]:j(t)}function F({filter:t,sort:e,reverse:n,transform:r,...o}={},i){var a;return void 0===r&&(null!=t&&(a=t,r=(t,e)=>{const n=h(t,a);return{data:t,facets:e.map((t=>t.filter((t=>n[t]))))}}),null!=e&&(r=I(r,function(t){return("function"==typeof t&&1!==t.length?U:q)(t)}(e))),n&&(r=I(r,W))),{...o,transform:I(r,i)}}function D(t,e){return{transform(n){const r=t.transform(n),o=e.transform(n);return J(r)||J(o)?Array.from(r,((t,e)=>new Date((+r[e]+ +o[e])/2))):Float64Array.from(r,((t,e)=>(+r[e]+ +o[e])/2))},label:t.label}}function X(t){return void 0===t||t&&t.toString===f&&"function"!=typeof t.transform?t:{value:t}}function I(t,e){return null==t?null===e?void 0:e:null==e?null===t?void 0:t:(n,r)=>(({data:n,facets:r}=t(n,r)),e(L(n),r))}function U(t){return(e,n)=>{const r=(n,r)=>t(e[n],e[r]);return{data:e,facets:n.map((t=>t.slice().sort(r)))}}}function q(t){return(e,n)=>{const r=h(e,t),o=(t,e)=>i(r[t],r[e]);return{data:e,facets:n.map((t=>t.slice().sort(o)))}}}function W(t,e){return{data:t,facets:e.map((t=>t.slice().reverse()))}}function V(t){return{transform:e=>h(e,t,Float64Array),label:G(t)}}function Z(t=[],e){const n=Object.create(null);for(let[r,{value:o,scale:i}]of t)void 0!==r&&(void 0!==i&&(i=e[i],void 0!==i&&(o=Array.from(o,i))),n[r]=o);return n}function H(t){for(const e of t){if(null==e)continue;const t=typeof e;return"string"===t||"boolean"===t}}function J(t){for(const e of t)if(null!=e)return e instanceof Date}class K{constructor({name:t="x",axis:e,ticks:n,tickSize:r=("fx"===t?0:6),tickPadding:o=(0===r?9:3),tickFormat:i,grid:a,label:l,labelAnchor:s,labelOffset:c,tickRotate:u}={}){this.name=t,this.axis=C(e,"axis",["top","bottom"]),this.ticks=n,this.tickSize=v(r),this.tickPadding=v(o),this.tickFormat=i,this.grid=k(a),this.label=x(l),this.labelAnchor=$(s,"labelAnchor",["center","left","right"]),this.labelOffset=v(c),this.tickRotate=v(u)}render(t,{[this.name]:n,fy:r},o,{width:i,height:a,marginTop:l,marginRight:s,marginBottom:c,marginLeft:u,facetMarginTop:f,facetMarginBottom:d,labelMarginLeft:p=0,labelMarginRight:h=0}){const{axis:m,grid:y,label:g,labelAnchor:x,labelOffset:v,tickRotate:k}=this,b="x"===this.name?0:"top"===m?l-f:c-d,w="top"===m?-1:1,O=w*b+("top"===m?l:a-c);return e.create("svg:g").attr("transform",`translate(0,${O})`).call(tt("top"===m?e.axisTop:e.axisBottom,n,this)).call(et,k).attr("font-size",null).attr("font-family",null).call((t=>t.select(".domain").remove())).call(y?r?function(t,e){const n=t.bandwidth();return r=>r.selectAll(".tick").append("path").attr("stroke","currentColor").attr("stroke-opacity",.1).attr("d",t.domain().map((r=>`M0,${t(r)+e}v${n}`)).join(""))}(r,-O):(R=w*(c+l-a),t=>t.selectAll(".tick line").clone(!0).attr("stroke-opacity",.1).attr("y2",R)):()=>{}).call(g?t=>t.append("text").attr("fill","currentColor").attr("transform",`translate(${"center"===x?(i+u-s)/2:"right"===x?i+h:-p},${v*w})`).attr("dy","top"===m?"1em":"-0.32em").attr("text-anchor","center"===x?"middle":"right"===x?"end":"start").text(g):()=>{}).node();var R}}class Q{constructor({name:t="y",axis:e,ticks:n,tickSize:r=("fy"===t?0:6),tickPadding:o=(0===r?9:3),tickFormat:i,grid:a,label:l,labelAnchor:s,labelOffset:c,tickRotate:u}={}){this.name=t,this.axis=C(e,"axis",["left","right"]),this.ticks=n,this.tickSize=v(r),this.tickPadding=v(o),this.tickFormat=i,this.grid=k(a),this.label=x(l),this.labelAnchor=$(s,"labelAnchor",["center","top","bottom"]),this.labelOffset=v(c),this.tickRotate=v(u)}render(t,{[this.name]:n,fx:r},o,{width:i,height:a,marginTop:l,marginRight:s,marginBottom:c,marginLeft:u,facetMarginLeft:f,facetMarginRight:d}){const{axis:p,grid:h,label:m,labelAnchor:y,labelOffset:g,tickRotate:x}=this,v="y"===this.name?0:"left"===p?u-f:s-d,k="left"===p?-1:1,b=k*v+("right"===p?i-s:u);return e.create("svg:g").attr("transform",`translate(${b},0)`).call(tt("right"===p?e.axisRight:e.axisLeft,n,this)).call(et,x).attr("font-size",null).attr("font-family",null).call((t=>t.select(".domain").remove())).call(h?r?function(t,e){const n=t.bandwidth();return r=>r.selectAll(".tick").append("path").attr("stroke","currentColor").attr("stroke-opacity",.1).attr("d",t.domain().map((r=>`M${t(r)+e},0h${n}`)).join(""))}(r,-b):(w=k*(u+s-i),t=>t.selectAll(".tick line").clone(!0).attr("stroke-opacity",.1).attr("x2",w)):()=>{}).call(m?t=>t.append("text").attr("fill","currentColor").attr("transform",`translate(${g*k},${"center"===y?(a+l-c)/2:"bottom"===y?a-c:l})${"center"===y?" rotate(-90)":""}`).attr("dy","center"===y?"right"===p?"-0.32em":"0.75em":"bottom"===y?"1.4em":"-1em").attr("text-anchor","center"===y?"middle":"right"===p?"end":"start").text(m):()=>{}).node();var w}}function tt(t,r,{ticks:o,tickSize:i,tickPadding:a,tickFormat:l}){return r.tickFormat||"function"==typeof l||(l=void 0===l?J(r.domain())?n:x:("string"==typeof l?J(r.domain())?e.utcFormat:e.format:O)(l)),t(r).ticks(Array.isArray(o)?null:o,"function"==typeof l?null:l).tickFormat("function"==typeof l?l:null).tickSizeInner(i).tickSizeOuter(0).tickPadding(a).tickValues(Array.isArray(o)?o:null)}function et(t,e){if(!(e=+e))return;const n=Math.PI/180,r=t.selectAll("text").attr("dy","0.32em"),o=+r.attr("y");if(o){const t=Math.sign(o);r.attr("y",null).attr("transform",`translate(0, ${o+4*t*Math.cos(e*n)}) rotate(${e})`).attr("text-anchor",Math.abs(e)<10?"middle":e<0^t>0?"start":"end")}else{const t=+r.attr("x"),o=Math.sign(t);r.attr("x",null).attr("transform",`translate(${t+4*o*Math.abs(Math.sin(e*n))}, 0) rotate(${e})`).attr("text-anchor",Math.abs(e)>60?"middle":o>0?"start":"end")}}function nt(t,e,n){if(void 0===e.ticks){const[r,o]=t.scale.range();e.ticks=Math.abs(o-r)/n}}function rt(t,e,n){void 0===t.labelAnchor&&(t.labelAnchor="ordinal"===e.type?"center":e.reverse?"left":"right"),void 0===t.label&&(t.label=it(n,e,t,"x"))}function ot(t,e,n,r){void 0===t.labelAnchor&&(t.labelAnchor="ordinal"===n.type?"center":e&&"top"===e.axis?"bottom":"top"),void 0===t.label&&(t.label=it(r,n,t,"y"))}function it(t=[],e,n,r){let o;for(const{label:e}of t)if(void 0!==e)if(void 0===o)o=e;else if(o!==e)return;if(void 0!==o){const{percent:t,reverse:i}=e;if("temporal"===e.type&&/^(date|time|year)$/i.test(o))return;"ordinal"===e.type||"x"!==r&&"y"!==r||(t&&(o=`${o} (%)`),o="center"===n.labelAnchor?`${o} →`:"x"===r?i?`← ${o}`:`${o} →`:`${i?"↓ ":"↑ "}${o}`)}return o}function at(t,{x:e,y:n,...r},o){return void 0===e&&void 0===n?o:[new lt(t,{x:e,y:n,...r},o)]}class lt extends d{constructor(t,{x:e,y:n,...r}={},o=[]){super(t,[{name:"fx",value:e,scale:"fx",optional:!0},{name:"fy",value:n,scale:"fy",optional:!0}],r),this.marks=o.flat(1/0),this.marksChannels=void 0,this.marksIndex=void 0,this.marksIndexByFacet=void 0}initialize(){const{index:t,channels:e}=super.initialize(),n=void 0===t?[]:function(t,e){return(e.length>1?ut:ct)(t,...e)}(t,e),r=Array.from(n,b),o=Array.from(n,w),i=[],a=this.marksChannels=[],l=this.marksIndex=new Array(this.marks.length),s=this.marksIndexByFacet=function(t){return new(t.length>1?dt:ft)}(e);for(const t of r)s.set(t,new Array(this.marks.length));for(let t=0;t<this.marks.length;++t){const e=this.marks[t],n=e.data===this.data?o:void 0,{index:c,channels:u}=e.initialize(n);if(void 0!==c)if(n){for(let e=0;e<r.length;++e)s.get(r[e])[t]=c[e];l[t]=[]}else{for(let e=0;e<r.length;++e)s.get(r[e])[t]=c;l[t]=c}for(const[,t]of u)i.push([,t]);a.push(u)}return{index:t,channels:[...e,...i]}}render(t,n,r,o,i){const{marks:a,marksChannels:l,marksIndex:s,marksIndexByFacet:c}=this,{fx:u,fy:f}=n,d=f&&{marginTop:0,marginBottom:0,height:f.bandwidth()},p=u&&{marginRight:0,marginLeft:0,width:u.bandwidth()},h={...o,...p,...d},m=l.map((t=>Z(t,n)));return e.create("svg:g").call((t=>{if(f&&i.y){const e=f.domain(),r=i.y,a=st(r),l="bottom"===r.labelAnchor?e.length-1:"center"===r.labelAnchor?e.length>>1:0,s={...o,...d};t.selectAll().data(e).join("g").attr("transform",(t=>`translate(0,${f(t)})`)).append(((t,e)=>(e===l?r:a).render(null,n,null,s)))}if(u&&i.x){const e=u.domain(),r=i.x,a=st(r),l="right"===r.labelAnchor?e.length-1:"center"===r.labelAnchor?e.length>>1:0,{marginLeft:s,marginRight:c}=o,f={...o,...p,labelMarginLeft:s,labelMarginRight:c};t.selectAll().data(e).join("g").attr("transform",(t=>`translate(${u(t)},0)`)).append(((t,e)=>(e===l?r:a).render(null,n,null,f)))}})).call((t=>t.selectAll().data(function({fx:t,fy:n}){return t&&n?e.cross(t.domain(),n.domain()):t?t.domain():n.domain()}(n)).join("g").attr("transform",function(t,e){return t&&e?([n,r])=>`translate(${t(n)},${e(r)})`:t?e=>`translate(${t(e)},0)`:t=>`translate(0,${e(t)})`}(u,f)).each((function(t){const e=c.get(t)||s;for(let t=0;t<a.length;++t){const r=a[t].render(e[t],n,m[t],h);null!=r&&this.appendChild(r)}})))).node()}}function st(t){return void 0===t||void 0===t.label?t:Object.assign(Object.create(t),{label:void 0})}function ct(t,[,{value:n}]){return e.groups(t,(t=>n[t]))}function ut(t,[,{value:n}],[,{value:r}]){return e.groups(t,(t=>n[t]),(t=>r[t])).flatMap((([t,e])=>e.map((([e,n])=>[[t,e],n]))))}class ft{constructor(){this._=new e.InternMap}has(t){return this._.has(t)}get(t){return this._.get(t)}set(t,e){return this._.set(t,e),this}}class dt extends ft{has([t,e]){const n=super.get(t);return!!n&&n.has(e)}get([t,e]){const n=super.get(t);return n&&n.get(e)}set([t,n],r){const o=super.get(t);return o?o.set(n,r):super.set(t,new e.InternMap([[n,r]])),this}}const pt=Symbol("position"),ht=Symbol("color"),mt=Symbol("radius"),yt=Symbol("opacity"),gt=new Map([["x",pt],["y",pt],["fx",pt],["fy",pt],["r",mt],["color",ht],["opacity",yt]]),xt=new Map([["number",e.interpolateNumber],["rgb",e.interpolateRgb],["hsl",e.interpolateHsl],["hcl",e.interpolateHcl],["lab",e.interpolateLab]]),vt=new Map([["brbg",e.interpolateBrBG],["prgn",e.interpolatePRGn],["piyg",e.interpolatePiYG],["puor",e.interpolatePuOr],["rdbu",e.interpolateRdBu],["rdgy",e.interpolateRdGy],["rdylbu",e.interpolateRdYlBu],["rdylgn",e.interpolateRdYlGn],["spectral",e.interpolateSpectral],["burd",t=>e.interpolateRdBu(1-t)],["buylrd",t=>e.interpolateRdYlBu(1-t)],["blues",e.interpolateBlues],["greens",e.interpolateGreens],["greys",e.interpolateGreys],["purples",e.interpolatePurples],["reds",e.interpolateReds],["oranges",e.interpolateOranges],["turbo",e.interpolateTurbo],["viridis",e.interpolateViridis],["magma",e.interpolateMagma],["inferno",e.interpolateInferno],["plasma",e.interpolatePlasma],["cividis",e.interpolateCividis],["cubehelix",e.interpolateCubehelixDefault],["warm",e.interpolateWarm],["cool",e.interpolateCool],["bugn",e.interpolateBuGn],["bupu",e.interpolateBuPu],["gnbu",e.interpolateGnBu],["orrd",e.interpolateOrRd],["pubugn",e.interpolatePuBuGn],["pubu",e.interpolatePuBu],["purd",e.interpolatePuRd],["rdpu",e.interpolateRdPu],["ylgnbu",e.interpolateYlGnBu],["ylgn",e.interpolateYlGn],["ylorbr",e.interpolateYlOrBr],["ylorrd",e.interpolateYlOrRd],["rainbow",e.interpolateRainbow],["sinebow",e.interpolateSinebow]]);function kt(t){const e=(t+"").toLowerCase();if(!xt.has(e))throw new Error(`unknown interpolator: ${e}`);return xt.get(e)}function bt(t){const e=(t+"").toLowerCase();if(!vt.has(e))throw new Error(`unknown scheme: ${e}`);return vt.get(e)}function wt(t,n,r,{nice:o,clamp:i,zero:a,domain:l=(gt.get(t)===mt||gt.get(t)===yt?Bt:Rt)(r),percent:s,round:c,range:u=(gt.get(t)===mt?Mt(r,l):gt.get(t)===yt?[0,1]:void 0),scheme:f,type:d,interpolate:p=(gt.get(t)===ht?void 0!==u?e.interpolateRgb:void 0!==f?bt(f):"cyclical"===d?e.interpolateRainbow:e.interpolateTurbo:c?e.interpolateRound:void 0),reverse:h,inset:m}){var y;return a&&(l=l[1]<0?[l[0],0]:l[0]>0?[0,l[1]]:l),(h=!!h)&&(l=e.reverse(l)),n.domain(l),o&&n.nice(!0===o?void 0:o),void 0!==p&&("function"!=typeof p?p=kt(p):1===p.length&&(h&&(y=p,p=t=>y(1-t)),p=O(p)),n.interpolate(p)),void 0!==u&&n.range(u),i&&n.clamp(i),{type:"quantitative",reverse:h,domain:l,range:u,scale:n,inset:m,percent:s}}function Ot(t,n,{exponent:r=1,...o}){return wt(t,e.scalePow().exponent(r),n,o)}function Rt(t,n){return[e.min(t,(({value:t})=>void 0===t?t:e.min(t,n))),e.max(t,(({value:t})=>void 0===t?t:e.max(t,n)))]}function Bt(t){return[0,e.max(t,(({value:t})=>void 0===t?t:e.max(t)))]}function Mt(t,n){const r=e.quantile(t,.5,(({value:t})=>void 0===t?NaN:e.quantile(t,.25,s)));return n.map((t=>3*Math.sqrt(t/r)))}function $t(t){for(const{value:e}of t)if(void 0!==e)for(let n of e){if(n=+n,n>0)return Rt(t,s);if(n<0)return Rt(t,c)}return[1,10]}function Ct(t,e,n,r){const o=wt(t,e,n,r);return o.type="temporal",o}const Lt=new Map([["accent",e.schemeAccent],["category10",e.schemeCategory10],["dark2",e.schemeDark2],["paired",e.schemePaired],["pastel1",e.schemePastel1],["pastel2",e.schemePastel2],["set1",e.schemeSet1],["set2",e.schemeSet2],["set3",e.schemeSet3],["tableau10",e.schemeTableau10],["brbg",At(e.schemeBrBG,e.interpolateBrBG)],["prgn",At(e.schemePRGn,e.interpolatePRGn)],["piyg",At(e.schemePiYG,e.interpolatePiYG)],["puor",At(e.schemePuOr,e.interpolatePuOr)],["rdbu",At(e.schemeRdBu,e.interpolateRdBu)],["rdgy",At(e.schemeRdGy,e.interpolateRdGy)],["rdylbu",At(e.schemeRdYlBu,e.interpolateRdYlBu)],["rdylgn",At(e.schemeRdYlGn,e.interpolateRdYlGn)],["spectral",At(e.schemeSpectral,e.interpolateSpectral)],["burd",zt(e.schemeRdBu,e.interpolateRdBu)],["buylrd",zt(e.schemeRdGy,e.interpolateRdGy)],["blues",Tt(e.schemeBlues,e.interpolateBlues)],["greens",Tt(e.schemeGreens,e.interpolateGreens)],["greys",Tt(e.schemeGreys,e.interpolateGreys)],["oranges",Tt(e.schemeOranges,e.interpolateOranges)],["purples",Tt(e.schemePurples,e.interpolatePurples)],["reds",Tt(e.schemeReds,e.interpolateReds)],["turbo",St(e.interpolateTurbo)],["viridis",St(e.interpolateViridis)],["magma",St(e.interpolateMagma)],["inferno",St(e.interpolateInferno)],["plasma",St(e.interpolatePlasma)],["cividis",St(e.interpolateCividis)],["cubehelix",St(e.interpolateCubehelixDefault)],["warm",St(e.interpolateWarm)],["cool",St(e.interpolateCool)],["bugn",Tt(e.schemeBuGn,e.interpolateBuGn)],["bupu",Tt(e.schemeBuPu,e.interpolateBuPu)],["gnbu",Tt(e.schemeGnBu,e.interpolateGnBu)],["orrd",Tt(e.schemeOrRd,e.interpolateOrRd)],["pubu",Tt(e.schemePuBu,e.interpolatePuBu)],["pubugn",Tt(e.schemePuBuGn,e.interpolatePuBuGn)],["purd",Tt(e.schemePuRd,e.interpolatePuRd)],["rdpu",Tt(e.schemeRdPu,e.interpolateRdPu)],["ylgn",Tt(e.schemeYlGn,e.interpolateYlGn)],["ylgnbu",Tt(e.schemeYlGnBu,e.interpolateYlGnBu)],["ylorbr",Tt(e.schemeYlOrBr,e.interpolateYlOrBr)],["ylorrd",Tt(e.schemeYlOrRd,e.interpolateYlOrRd)],["rainbow",St(e.interpolateRainbow)],["sinebow",St(e.interpolateSinebow)]]);function Tt(t,n){return({length:r})=>(r=r>3?Math.floor(r):3)>9?e.quantize(n,r):t[r]}function At(t,n){return({length:r})=>(r=r>3?Math.floor(r):3)>11?e.quantize(n,r):t[r]}function zt(t,n){return({length:r})=>(r=r>3?Math.floor(r):3)>11?e.quantize((t=>n(1-t)),r):t[r].slice().reverse()}function St(t){return({length:n})=>e.quantize(t,n>0?Math.floor(n):0)}function Yt(t){const e=(t+"").toLowerCase();if(!Lt.has(e))throw new Error(`unknown scheme: ${e}`);return Lt.get(e)}function Pt(t,n,{domain:r=_t(n),range:o,reverse:i,inset:a}){return(i=!!i)&&(r=e.reverse(r)),t.domain(r),void 0!==o&&("function"==typeof o&&(o=o(r)),t.range(o)),{type:"ordinal",reverse:i,domain:r,range:o,scale:t,inset:a}}function Nt(t,e,n={}){const{round:r}=n;return void 0!==r&&t.round(r),(t=Pt(t,e,n)).round=r,t}function _t(t){const n=new e.InternSet;for(const{value:e}of t)if(void 0!==e)for(const t of e)n.add(t);return e.sort(n,i)}function jt(t,e){if(void 0===t.range){const{inset:n=0}=t,{width:r,marginLeft:o=0,marginRight:i=0}=e;t.scale.range([o+n,r-i-n])}Et(t)}function Gt(t,e){if(void 0===t.range){const{inset:n=0}=t,{height:r,marginTop:o=0,marginBottom:i=0}=e,a=[r-i-n,o+n];"ordinal"===t.type&&a.reverse(),t.scale.range(a)}Et(t)}function Et(t){void 0===t.round&&"ordinal"===t.type&&t.scale.step()>=5&&t.scale.round(!0)}function Ft(t,n=[],r={}){switch(function(t,e,{type:n,domain:r,range:o}){if("fx"===t||"fy"===t)return"band";if(void 0!==n){for(const{type:t}of e)if(void 0!==t&&n!==t)throw new Error(`scale incompatible with channel: ${n} !== ${t}`);return n}if(gt.get(t)===mt)return"sqrt";if(gt.get(t)===yt)return"linear";for(const{type:t}of e)if(void 0!==t)return t;if((r||o||[]).length>2)return Dt(t);if(void 0!==r)return H(r)?Dt(t):J(r)?"utc":"linear";const i=e.map((({value:t})=>t)).filter((t=>void 0!==t));return i.some(H)?Dt(t):i.some(J)?"utc":"linear"}(t,n,r)){case"diverging":return function(t,n,{nice:r,clamp:o,domain:i=Rt(n),pivot:a=0,range:l,scheme:s,interpolate:c=(gt.get(t)===ht?void 0!==l?e.interpolateRgb:void 0!==s?bt(s):e.interpolateRdBu:void 0),reverse:u}){i=[Math.min(i[0],a),a,Math.max(i[1],a)],(u=!!u)&&(i=e.reverse(i)),void 0!==c&&"function"!=typeof c&&(c=kt(c)),void 0!==l&&(c=e.piecewise(c,l));const f=e.scaleDiverging(i,c);return o&&f.clamp(o),r&&f.nice(r),{type:"quantitative",reverse:u,domain:i,scale:f}}(t,n,r);case"categorical":case"ordinal":return function(t,n,{scheme:r,type:o,range:i=(gt.get(t)===ht?void 0!==r?Yt(r):"ordinal"===o?Lt.get("turbo"):e.schemeTableau10:void 0),...a}){return Pt(e.scaleOrdinal().unknown(void 0),n,{range:i,...a})}(t,n,r);case"cyclical":case"sequential":case"linear":return function(t,n,r){return wt(t,e.scaleLinear(),n,r)}(t,n,r);case"sqrt":return Ot(t,n,{...r,exponent:.5});case"pow":return Ot(t,n,r);case"log":return function(t,n,{base:r=10,domain:o=$t(n),...i}){return wt(t,e.scaleLog().base(r),n,{domain:o,...i})}(t,n,r);case"symlog":return function(t,n,{constant:r=1,...o}){return wt(t,e.scaleSymlog().constant(r),n,o)}(t,n,r);case"utc":return function(t,n,r){return Ct(t,e.scaleUtc(),n,r)}(t,n,r);case"time":return function(t,n,r){return Ct(t,e.scaleTime(),n,r)}(t,n,r);case"point":return function(t,n,{align:r=.5,padding:o=.5,...i}){return Nt(e.scalePoint().align(r).padding(o),n,i)}(0,n,r);case"band":return function(t,n,{align:r=.5,padding:o=.1,paddingInner:i=o,paddingOuter:a=("fx"===t||"fy"===t?0:o),...l}){return Nt(e.scaleBand().align(r).paddingInner(i).paddingOuter(a),n,l)}(t,n,r);case"identity":return gt.get(t)===pt?{type:"identity",scale:e.scaleIdentity()}:void 0;case void 0:return;default:throw new Error(`unknown scale type: ${r.type}`)}}function Dt(t){return gt.get(t)===pt?"point":"ordinal"}const Xt="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5;function It(t,{fill:e,fillOpacity:n,stroke:r,strokeWidth:o,strokeOpacity:i,strokeLinejoin:a,strokeLinecap:l,strokeMiterlimit:s,strokeDasharray:c,mixBlendMode:u}={}){t.fill=Ht(e,"currentColor"),t.fillOpacity=Jt(n,1),t.stroke=Ht(r,"none"),t.strokeWidth=Jt(o,1),t.strokeOpacity=Jt(i,1),t.strokeLinejoin=Ht(a,"miter"),t.strokeLinecap=Ht(l,"butt"),t.strokeMiterlimit=Jt(s,4),t.strokeDasharray=x(c),t.mixBlendMode=Ht(u,"normal")}function Ut(t,e){Wt(t,"fill",e.fill),Wt(t,"fill-opacity",e.fillOpacity),Wt(t,"stroke",e.stroke),Wt(t,"stroke-width",e.strokeWidth),Wt(t,"stroke-opacity",e.strokeOpacity),Wt(t,"stroke-linejoin",e.strokeLinejoin),Wt(t,"stroke-linecap",e.strokeLinecap),Wt(t,"stroke-miterlimit",e.strokeMiterlimit),Wt(t,"stroke-dasharray",e.strokeDasharray)}function qt(t,e){Vt(t,"mix-blend-mode",e.mixBlendMode)}function Wt(t,e,n){null!=n&&t.attr(e,n)}function Vt(t,e,n){null!=n&&t.style(e,n)}function Zt(t,e,n,r,o){r=r?Xt:0,o=o?Xt:0,e&&e.bandwidth&&(r+=e.bandwidth()/2),n&&n.bandwidth&&(o+=n.bandwidth()/2),(r||o)&&t.attr("transform",`translate(${r},${o})`)}function Ht(t,e){if((t=x(t))!==e)return t}function Jt(t,e){if((t=v(t))!==e)return t}function Kt(t={}){const{facet:n,style:r,caption:o}=t;if(void 0!==n){const{marks:e}=t,{data:r}=n;t={...t,marks:at(r,n,e)}}const i=void 0===t.marks?[]:t.marks.flat(1/0),a=new Map,l=new Map,s=new Map;for(const e of i){if(a.has(e))throw new Error("duplicate mark");const{index:n,channels:r}=e.initialize();for(const[,e]of r){const{scale:n}=e;if(void 0!==n){const r=s.get(n),{percent:o,transform:i=(o?t=>100*t:void 0)}=t[n]||{};void 0!==i&&(e.value=Array.from(e.value,i)),r?r.push(e):s.set(n,[e])}}a.set(e,r),l.set(e,n)}const c=function(t,{inset:e,round:n,nice:r,align:o,padding:i,...a}={}){const l={};for(const s of gt.keys())if(t.has(s)||a[s]){const c=Ft(s,t.get(s),{inset:"x"===s||"y"===s?e:void 0,round:gt.get(s)===pt?n:void 0,nice:r,align:o,padding:i,...a[s]});c&&(l[s]=c)}return l}(s,t),u=function(t){return Object.fromEntries(Object.entries(t).map((([t,{scale:e}])=>[t,e])))}(c),f=function({x:t,y:e,fx:n,fy:r},{x:o={},y:i={},fx:a={},fy:l={},grid:s,facet:{grid:c}={}}={}){let{axis:u=!0}=o,{axis:f=!0}=i,{axis:d=!0}=a,{axis:p=!0}=l;return t?!0===u&&(u="bottom"):u=null,e?!0===f&&(f="left"):f=null,n?!0===d&&(d="bottom"===u?"top":"bottom"):d=null,r?!0===p&&(p="left"===f?"right":"left"):p=null,{...u&&{x:new K({grid:s,...o,axis:u})},...f&&{y:new Q({grid:s,...i,axis:f})},...d&&{fx:new K({name:"fx",grid:c,...a,axis:d})},...p&&{fy:new Q({name:"fy",grid:c,...l,axis:p})}}}(c,t),d=function(t,{x:{axis:e}={},y:{axis:n}={},fx:{axis:r}={},fy:{axis:o}={}},{width:i=640,height:a=Qt(t),facet:{marginTop:l=("top"===r?30:0),marginRight:s=("right"===o?40:0),marginBottom:c=("bottom"===r?30:0),marginLeft:u=("left"===o?40:0)}={},marginTop:f=Math.max(("top"===e?30:0)+l,n||o?20:.5-Xt),marginRight:d=Math.max(("right"===n?40:0)+s,e||r?20:.5+Xt),marginBottom:p=Math.max(("bottom"===e?30:0)+c,n||o?20:.5+Xt),marginLeft:h=Math.max(("left"===n?40:0)+u,e||r?20:.5-Xt)}={}){return{width:i,height:a,marginTop:f,marginRight:d,marginBottom:p,marginLeft:h,facetMarginTop:l,facetMarginRight:s,facetMarginBottom:c,facetMarginLeft:u}}(c,f,t);!function({x:t,y:e,fx:n,fy:r},o){n&&jt(n,o),r&&Gt(r,o),t&&jt(t,n?{width:n.scale.bandwidth()}:o),e&&Gt(e,r?{height:r.scale.bandwidth()}:o)}(c,d),function({x:t,y:e,fx:n,fy:r},{x:o,y:i,fx:a,fy:l}){a&&nt(n,a,80),l&&nt(r,l,35),o&&nt(t,o,80),i&&nt(e,i,35)}(c,f),function(t,e,{x:n,y:r,fx:o,fy:i},a){if(o&&(rt(o,e.fx,t.get("fx")),void 0===o.labelOffset)){const{facetMarginTop:t,facetMarginBottom:e}=a;o.labelOffset="top"===o.axis?t:e}if(i&&(ot(i,o,e.fy,t.get("fy")),void 0===i.labelOffset)){const{facetMarginLeft:t,facetMarginRight:e}=a;i.labelOffset="left"===i.axis?t:e}if(n&&(rt(n,e.x,t.get("x")),void 0===n.labelOffset)){const{marginTop:t,marginBottom:e,facetMarginTop:r,facetMarginBottom:o}=a;n.labelOffset="top"===n.axis?t-r:e-o}if(r&&(ot(r,n,e.y,t.get("y")),void 0===r.labelOffset)){const{marginRight:t,marginLeft:e,facetMarginLeft:n,facetMarginRight:o}=a;r.labelOffset="left"===r.axis?e-n:t-o}}(s,c,f,d),t={...c,...d},f.x&&(t.x={...t.x,...f.x}),f.y&&(t.y={...t.y,...f.y}),f.fx&&(t.fx={...t.fx,...f.fx}),f.fy&&(t.fy={...t.fy,...f.fy});const p=void 0!==n&&u.fx?"fx":"x",h=void 0!==n&&u.fy?"fy":"y";f[p]&&i.unshift(f[p]),f[h]&&i.unshift(f[h]);const{width:m,height:y}=d,g=e.create("svg").attr("class","plot").attr("fill","currentColor").attr("text-anchor","middle").attr("width",m).attr("height",y).attr("viewBox",`0 0 ${m} ${y}`).each((function(){"string"==typeof r?this.style=r:Object.assign(this.style,r)})).node();for(const t of i){const e=a.get(t),n=l.get(t),r=t.render(n,u,Z(e,u),d,f);null!=r&&g.appendChild(r)}if(null==o)return g;const x=document.createElement("figure");x.appendChild(g);return x.appendChild(document.createElement("figcaption")).appendChild(o instanceof Node?o:document.createTextNode(o)),x}function Qt({y:t,fy:e,fx:n}){const r=e?e.scale.domain().length:1,o=t?"ordinal"===t.type?t.scale.domain().length:Math.max(7,17/r):1;return!(!t&&!e)*Math.max(1,Math.min(60,o*r))*20+30*!!n+60}const te=new Map([["basis",e.curveBasis],["basis-closed",e.curveBasisClosed],["basis-open",e.curveBasisOpen],["bundle",e.curveBundle],["bump-x",e.curveBumpX],["bump-y",e.curveBumpY],["cardinal",e.curveCardinal],["cardinal-closed",e.curveCardinalClosed],["cardinal-open",e.curveCardinalOpen],["catmull-rom",e.curveCatmullRom],["catmull-rom-closed",e.curveCatmullRomClosed],["catmull-rom-open",e.curveCatmullRomOpen],["linear",e.curveLinear],["linear-closed",e.curveLinearClosed],["monotone-x",e.curveMonotoneX],["monotone-y",e.curveMonotoneY],["natural",e.curveNatural],["step",e.curveStep],["step-after",e.curveStepAfter],["step-before",e.curveStepBefore]]);function ee(t=e.curveLinear,n){if("function"==typeof t)return t;const r=te.get((t+"").toLowerCase());if(!r)throw new Error(`unknown curve: ${t}`);if(void 0!==n)switch(r){case e.curveBundle:return r.beta(n);case e.curveCardinalClosed:case e.curveCardinalOpen:case e.curveCardinal:return r.tension(n);case e.curveCatmullRomClosed:case e.curveCatmullRomOpen:case e.curveCatmullRom:return r.alpha(n)}return r}function ne({y1:t,y:e=t,x:n,...r}={}){const[o,i,a,l]=ae(e,n,"x",r);return{y1:t,y:i,x1:a,x2:l,x:D(a,l),...o}}function re({x1:t,x:e=t,y:n,...r}={}){const[o,i,a,l]=ae(e,n,"y",r);return{x1:t,x:i,y1:a,y2:l,y:D(a,l),...o}}function oe({x:t,x1:e,x2:n,...r}={}){return void 0===e&&null==n?(void 0===t&&(t=g),ne({x:t,...r})):([e,n]=T(t,e,n),{...r,x1:e,x2:n})}function ie({y:t,y1:e,y2:n,...r}={}){return void 0===e&&null==n?(void 0===t&&(t=g),re({y:t,...r})):([e,n]=T(t,e,n),{...r,y1:e,y2:n})}function ae(t,n=(()=>1),r,{offset:o,order:i,reverse:a,...l}={}){const s=z(l),[c,u]=E(t),[f,d]=j(n),[p,y]=j(n);return o=function(t){if(null==t)return;switch((t+"").toLowerCase()){case"expand":return se;case"silhouette":return ce;case"wiggle":return ue}throw new Error(`unknown offset: ${t}`)}(o),i=function(t,e,n){if(void 0===t&&e===ue)return ye;if(null==t)return;if("string"==typeof t){switch(t.toLowerCase()){case"value":case n:return de;case"z":return pe;case"sum":return he;case"appearance":return me;case"inside-out":return ye}return ge(m(t))}return"function"==typeof t?ge(t):function(t){return(e,n,r,o)=>xe(o,t)}(t)}(i,o,r),[F(l,((r,l)=>{const c=null==t?void 0:u(h(r,t)),f=h(r,n,Float64Array),p=h(r,s),m=i&&i(r,c,f,p),g=r.length,x=d(new Float64Array(g)),v=y(new Float64Array(g));for(const t of l){const n=c?Array.from(e.group(t,(t=>c[t])).values()):[t];m&&ve(n,m);for(const t of n){let e=0,n=0;a&&t.reverse();for(const r of t){const t=f[r];t<0?e=v[r]=(x[r]=e)+t:t>0?n=v[r]=(x[r]=n)+t:v[r]=x[r]=n}}o&&o(n,x,v,p)}return{data:r,facets:l}})),c,f,p]}function le(t,e){let n=0,r=0;for(const o of t){const t=e[o];t<n&&(n=t),t>r&&(r=t)}return[n,r]}function se(t,e,n){for(const r of t){const[t,o]=le(r,n);for(const i of r){const r=1/(o-t||1);e[i]=r*(e[i]-t),n[i]=r*(n[i]-t)}}}function ce(t,e,n){for(const r of t){const[t,o]=le(r,n);for(const i of r){const r=(o+t)/2;e[i]-=r,n[i]-=r}}fe(t,e,n)}function ue(t,n,r,o){const i=new e.InternMap;let a=0;for(const l of t){let t=-1;const s=l.map((t=>Math.abs(r[t]-n[t]))),c=l.map((e=>{t=o?o[e]:++t;const a=r[e]-n[e],l=i.has(t)?a-i.get(t):0;return i.set(t,a),l})),u=[0,...e.cumsum(c)];for(const t of l)n[t]+=a,r[t]+=a;const f=e.sum(s);f&&(a-=e.sum(s,((t,e)=>(c[e]/2+u[e])*t))/f)}fe(t,n,r)}function fe(t,n,r){const o=e.min(t,(t=>e.min(t,(t=>n[t]))));for(const e of t)for(const t of e)n[t]-=o,r[t]-=o}function de(t,e,n){return n}function pe(t,e,n,r){return r}function he(t,n,r,o){return xe(o,e.groupSort(P(t),(t=>e.sum(t,(t=>r[t]))),(t=>o[t])))}function me(t,n,r,o){return xe(o,e.groupSort(P(t),(t=>n[e.greatest(t,(t=>r[t]))]),(t=>o[t])))}function ye(t,n,r,o){const i=P(t),a=e.groupSort(i,(t=>n[e.greatest(t,(t=>r[t]))]),(t=>o[t])),l=e.rollup(i,(t=>e.sum(t,(t=>r[t]))),(t=>o[t])),s=[],c=[];let u=0;for(const t of a)u<0?(u+=l.get(t),s.push(t)):(u-=l.get(t),c.push(t));return xe(o,c.reverse().concat(s))}function ge(t){return e=>h(e,t)}function xe(t,n){return n=new e.InternMap(n.map(((t,e)=>[t,e]))),t.map((t=>n.get(t)))}function ve(t,e){for(const n of t)n.sort(((t,n)=>i(e[t],e[n])))}class ke extends d{constructor(t,{x1:e,y1:n,x2:r,y2:o,z:i,title:a,fill:l,fillOpacity:s,stroke:c,strokeOpacity:u,curve:f,tension:d,...p}={}){const[h,m]=B(c,"none"),[y,g]=M(u),[x,v]=B(l,"none"===m?"currentColor":"none"),[k,b]=M(s);void 0===i&&null!=x&&(i=x),void 0===i&&null!=h&&(i=h),super(t,[{name:"x1",value:e,scale:"x"},{name:"y1",value:n,scale:"y"},{name:"x2",value:r,scale:"x",optional:!0},{name:"y2",value:o,scale:"y",optional:!0},{name:"z",value:i,optional:!0},{name:"title",value:a,optional:!0},{name:"fill",value:x,scale:"color",optional:!0},{name:"fillOpacity",value:k,scale:"opacity",optional:!0},{name:"stroke",value:h,scale:"color",optional:!0},{name:"strokeOpacity",value:y,scale:"opacity",optional:!0}],p),this.curve=ee(f,d),It(this,{fill:v,fillOpacity:b,stroke:m,strokeMiterlimit:"none"===m?void 0:1,strokeOpacity:g,...p})}render(t,{x:n,y:r},{x1:i,y1:a,x2:l=i,y2:s=a,z:c,title:u,fill:f,fillOpacity:d,stroke:p,strokeOpacity:h}){return e.create("svg:g").call(Ut,this).call(Zt,n,r).call((n=>n.selectAll().data(c?e.group(t,(t=>c[t])).values():[t]).join("path").call(qt,this).call(Wt,"fill",f&&(([t])=>f[t])).call(Wt,"fill-opacity",d&&(([t])=>d[t])).call(Wt,"stroke",p&&(([t])=>p[t])).call(Wt,"stroke-opacity",h&&(([t])=>h[t])).attr("d",e.area().curve(this.curve).defined((t=>o(i[t])&&o(a[t])&&o(l[t])&&o(s[t]))).x0((t=>i[t])).y0((t=>a[t])).x1((t=>l[t])).y1((t=>s[t]))).call(Y(u)))).node()}}class be extends d{constructor(t,e,{title:n,fill:r,fillOpacity:o,stroke:i,strokeOpacity:a,inset:l=0,insetTop:s=l,insetRight:c=l,insetBottom:u=l,insetLeft:f=l,rx:d,ry:p,...h}={}){const[m,y]=B(i,"none"),[g,x]=M(a),[k,b]=B(r,"none"===y?"currentColor":"none"),[w,O]=M(o);super(t,[...e,{name:"title",value:n,optional:!0},{name:"fill",value:k,scale:"color",optional:!0},{name:"fillOpacity",value:w,scale:"opacity",optional:!0},{name:"stroke",value:m,scale:"color",optional:!0},{name:"strokeOpacity",value:g,scale:"opacity",optional:!0}],h),It(this,{fill:b,fillOpacity:O,stroke:y,strokeOpacity:x,...h}),this.insetTop=v(s),this.insetRight=v(c),this.insetBottom=v(u),this.insetLeft=v(f),this.rx=Ht(d,"auto"),this.ry=Ht(p,"auto")}render(t,n,r,o){const{rx:i,ry:a}=this,{title:s,fill:c,fillOpacity:u,stroke:f,strokeOpacity:d}=r,p=l(t,...this._positions(r),c,u,f,d);return e.create("svg:g").call(Ut,this).call(this._transform,n).call((t=>t.selectAll().data(p).join("rect").call(qt,this).attr("x",this._x(n,r,o)).attr("width",this._width(n,r,o)).attr("y",this._y(n,r,o)).attr("height",this._height(n,r,o)).call(Wt,"fill",c&&(t=>c[t])).call(Wt,"fill-opacity",u&&(t=>u[t])).call(Wt,"stroke",f&&(t=>f[t])).call(Wt,"stroke-opacity",d&&(t=>d[t])).call(Wt,"rx",i).call(Wt,"ry",a).call(S(s)))).node()}_x(t,{x:e},{marginLeft:n}){const{insetLeft:r}=this;return e?t=>e[t]+r:n+r}_y(t,{y:e},{marginTop:n}){const{insetTop:r}=this;return e?t=>e[t]+r:n+r}_width({x:t},{x:e},{marginRight:n,marginLeft:r,width:o}){const{insetLeft:i,insetRight:a}=this,l=e?t.bandwidth():o-n-r;return Math.max(0,l-i-a)}_height({y:t},{y:e},{marginTop:n,marginBottom:r,height:o}){const{insetTop:i,insetBottom:a}=this,l=e?t.bandwidth():o-n-r;return Math.max(0,l-i-a)}}class we extends be{constructor(t,{x1:e,x2:n,y:r,...o}={}){super(t,[{name:"x1",value:e,scale:"x"},{name:"x2",value:n,scale:"x"},{name:"y",value:r,scale:"y",type:"band",optional:!0}],o)}_transform(t,{x:e}){t.call(Zt,e,null)}_positions({x1:t,x2:e,y:n}){return[t,e,n]}_x(t,{x1:e,x2:n}){const{insetLeft:r}=this;return t=>Math.min(e[t],n[t])+r}_width(t,{x1:e,x2:n}){const{insetLeft:r,insetRight:o}=this;return t=>Math.max(0,Math.abs(n[t]-e[t])-r-o)}}class Oe extends be{constructor(t,{x:e,y1:n,y2:r,...o}={}){super(t,[{name:"y1",value:n,scale:"y"},{name:"y2",value:r,scale:"y"},{name:"x",value:e,scale:"x",type:"band",optional:!0}],o)}_transform(t,{y:e}){t.call(Zt,null,e)}_positions({y1:t,y2:e,x:n}){return[t,e,n]}_y(t,{y1:e,y2:n}){const{insetTop:r}=this;return t=>Math.min(e[t],n[t])+r}_height(t,{y1:e,y2:n}){const{insetTop:r,insetBottom:o}=this;return t=>Math.max(0,Math.abs(n[t]-e[t])-r-o)}}class Re extends be{constructor(t,{x:e,y:n,...r}={}){super(t,[{name:"x",value:e,scale:"x",type:"band",optional:!0},{name:"y",value:n,scale:"y",type:"band",optional:!0}],r)}_transform(){}_positions({x:t,y:e}){return[t,e]}}class Be extends d{constructor(t,{x:e,y:n,r:r,title:o,fill:i,fillOpacity:a,stroke:l,strokeOpacity:s,...c}={}){const[u,f]=M(r,3),[d,p]=B(i,"none"),[h,m]=M(a),[y,g]=B(l,"none"===p?"currentColor":"none"),[x,v]=M(s);super(t,[{name:"x",value:e,scale:"x",optional:!0},{name:"y",value:n,scale:"y",optional:!0},{name:"r",value:u,scale:"r",optional:!0},{name:"title",value:o,optional:!0},{name:"fill",value:d,scale:"color",optional:!0},{name:"fillOpacity",value:h,scale:"opacity",optional:!0},{name:"stroke",value:y,scale:"color",optional:!0},{name:"strokeOpacity",value:x,scale:"opacity",optional:!0}],c),this.r=f,It(this,{fill:p,fillOpacity:m,stroke:g,strokeOpacity:v,strokeWidth:"none"===g?void 0:1.5,...c})}render(t,{x:n,y:r},{x:o,y:i,r:a,title:c,fill:u,fillOpacity:f,stroke:d,strokeOpacity:p},{width:h,height:m,marginTop:y,marginRight:g,marginBottom:x,marginLeft:v}){let k=l(t,o,i,u,f,d,p);return a&&(k=k.filter((t=>s(a[t])))),e.create("svg:g").call(Ut,this).call(Zt,n,r,.5,.5).call((t=>t.selectAll().data(k).join("circle").call(qt,this).attr("cx",o?t=>o[t]:(v+h-g)/2).attr("cy",i?t=>i[t]:(y+m-x)/2).attr("r",a?t=>a[t]:this.r).call(Wt,"fill",u&&(t=>u[t])).call(Wt,"fill-opacity",f&&(t=>f[t])).call(Wt,"stroke",d&&(t=>d[t])).call(Wt,"stroke-opacity",p&&(t=>p[t])).call(S(c)))).node()}}class Me extends d{constructor({fill:t="none",stroke:e=(null===t||"none"===t?"currentColor":"none"),inset:n=0,insetTop:r=n,insetRight:o=n,insetBottom:i=n,insetLeft:a=n,...l}={}){super(),It(this,{fill:t,stroke:e,...l}),this.insetTop=v(r),this.insetRight=v(o),this.insetBottom=v(i),this.insetLeft=v(a)}render(t,n,r,{marginTop:o,marginRight:i,marginBottom:a,marginLeft:l,width:s,height:c}){return e.create("svg:rect").call(Ut,this).call(qt,this).call(Zt,null,null,.5,.5).attr("x",l+this.insetLeft).attr("y",o+this.insetTop).attr("width",s-l-i-this.insetLeft-this.insetRight).attr("height",c-o-a-this.insetTop-this.insetBottom).node()}}class $e extends d{constructor(t,{x:e,y:n,z:r,title:o,fill:i,fillOpacity:a,stroke:l,strokeOpacity:s,curve:c,tension:u,...f}={}){const[d,p]=B(i,"none"),[h,m]=M(a),[y,g]=B(l,"currentColor"),[x,v]=M(s);void 0===r&&null!=y&&(r=y),void 0===r&&null!=d&&(r=d),super(t,[{name:"x",value:e,scale:"x"},{name:"y",value:n,scale:"y"},{name:"z",value:r,optional:!0},{name:"title",value:o,optional:!0},{name:"fill",value:d,scale:"color",optional:!0},{name:"fillOpacity",value:h,scale:"opacity",optional:!0},{name:"stroke",value:y,scale:"color",optional:!0},{name:"strokeOpacity",value:x,scale:"opacity",optional:!0}],f),this.curve=ee(c,u),It(this,{fill:p,fillOpacity:m,stroke:g,strokeMiterlimit:"none"===g?void 0:1,strokeOpacity:v,strokeWidth:"none"===g?void 0:1.5,...f})}render(t,{x:n,y:r},{x:i,y:a,z:l,title:s,fill:c,fillOpacity:u,stroke:f,strokeOpacity:d}){return e.create("svg:g").call(Ut,this).call(Zt,n,r,.5,.5).call((n=>n.selectAll().data(l?e.group(t,(t=>l[t])).values():[t]).join("path").call(qt,this).call(Wt,"fill",c&&(([t])=>c[t])).call(Wt,"fill-opacity",u&&(([t])=>u[t])).call(Wt,"stroke",f&&(([t])=>f[t])).call(Wt,"stroke-opacity",d&&(([t])=>d[t])).attr("d",e.line().curve(this.curve).defined((t=>o(i[t])&&o(a[t]))).x((t=>i[t])).y((t=>a[t]))).call(Y(s)))).node()}}class Ce extends d{constructor(t,{x1:e,y1:n,x2:r,y2:o,title:i,fill:a,fillOpacity:l,stroke:s,strokeOpacity:c,curve:u,...f}={}){const[d,p]=B(a,"none"),[h,m]=M(l),[y,g]=B(s,"currentColor"),[x,v]=M(c);super(t,[{name:"x1",value:e,scale:"x"},{name:"y1",value:n,scale:"y"},{name:"x2",value:r,scale:"x"},{name:"y2",value:o,scale:"y"},{name:"title",value:i,optional:!0},{name:"fill",value:d,scale:"color",optional:!0},{name:"fillOpacity",value:h,scale:"opacity",optional:!0},{name:"stroke",value:y,scale:"color",optional:!0},{name:"strokeOpacity",value:x,scale:"opacity",optional:!0}],f),this.curve=ee(u),It(this,{fill:p,fillOpacity:m,stroke:g,strokeMiterlimit:"none"===g?void 0:1,strokeOpacity:v,...f})}render(t,{x:n,y:r},{x1:o,y1:i,x2:a,y2:s,title:c,stroke:u,strokeOpacity:f}){const d=l(t,o,i,a,s,u,f);return e.create("svg:g").call(Ut,this).call(Zt,n,r,.5,.5).call((t=>t.selectAll().data(d).join("path").call(qt,this).attr("d",(t=>{const n=e.path(),r=this.curve(n);return r.lineStart(),r.point(o[t],i[t]),r.point(a[t],s[t]),r.lineEnd(),n+""})).call(Wt,"stroke",u&&(t=>u[t])).call(Wt,"stroke-opacity",f&&(t=>f[t])).call(S(c)))).node()}}class Le extends d{constructor(t,{x1:e,y1:n,x2:r,y2:o,title:i,fill:a,fillOpacity:l,stroke:s,strokeOpacity:c,inset:u=0,insetTop:f=u,insetRight:d=u,insetBottom:p=u,insetLeft:h=u,rx:m,ry:y,...g}={}){const[x,k]=B(s,"none"),[b,w]=M(c),[O,R]=B(a,"none"===k?"currentColor":"none"),[$,C]=M(l);super(t,[{name:"x1",value:e,scale:"x"},{name:"y1",value:n,scale:"y"},{name:"x2",value:r,scale:"x"},{name:"y2",value:o,scale:"y"},{name:"title",value:i,optional:!0},{name:"fill",value:O,scale:"color",optional:!0},{name:"fillOpacity",value:$,scale:"opacity",optional:!0},{name:"stroke",value:x,scale:"color",optional:!0},{name:"strokeOpacity",value:b,scale:"opacity",optional:!0}],g),It(this,{fill:R,fillOpacity:C,stroke:k,strokeOpacity:w,...g}),this.insetTop=v(f),this.insetRight=v(d),this.insetBottom=v(p),this.insetLeft=v(h),this.rx=Ht(m,"auto"),this.ry=Ht(y,"auto")}render(t,{x:n,y:r},{x1:o,y1:i,x2:a,y2:s,title:c,fill:u,fillOpacity:f,stroke:d,strokeOpacity:p}){const{rx:h,ry:m}=this,y=l(t,o,s,a,s,u,f,d,p);return e.create("svg:g").call(Ut,this).call(Zt,n,r).call((t=>t.selectAll().data(y).join("rect").call(qt,this).attr("x",(t=>Math.min(o[t],a[t])+this.insetLeft)).attr("y",(t=>Math.min(i[t],s[t])+this.insetTop)).attr("width",(t=>Math.max(0,Math.abs(a[t]-o[t])-this.insetLeft-this.insetRight))).attr("height",(t=>Math.max(0,Math.abs(i[t]-s[t])-this.insetTop-this.insetBottom))).call(Wt,"fill",u&&(t=>u[t])).call(Wt,"fill-opacity",f&&(t=>f[t])).call(Wt,"stroke",d&&(t=>d[t])).call(Wt,"stroke-opacity",p&&(t=>p[t])).call(Wt,"rx",h).call(Wt,"ry",m).call(S(c)))).node()}}class Te extends d{constructor(t,{x:e,y1:n,y2:r,title:o,stroke:i,inset:a=0,insetTop:l=a,insetBottom:s=a,...c}={}){const[u,f]=B(i,"currentColor");super(t,[{name:"x",value:e,scale:"x",optional:!0},{name:"y1",value:n,scale:"y",optional:!0},{name:"y2",value:r,scale:"y",optional:!0},{name:"title",value:o,optional:!0},{name:"stroke",value:u,scale:"color",optional:!0}],c),It(this,{stroke:f,...c}),this.insetTop=v(l),this.insetBottom=v(s)}render(t,{x:n,y:r},{x:o,y1:i,y2:a,title:s,stroke:c},{width:u,height:f,marginTop:d,marginRight:p,marginLeft:h,marginBottom:m}){const y=l(t,o,i,a,c);return e.create("svg:g").call(Ut,this).call(Zt,o&&n,null,.5,0).call((t=>t.selectAll("line").data(y).join("line").call(qt,this).attr("x1",o?t=>o[t]:(h+u-p)/2).attr("x2",o?t=>o[t]:(h+u-p)/2).attr("y1",i?t=>i[t]+this.insetTop:d+this.insetTop).attr("y2",a?r.bandwidth?t=>a[t]+r.bandwidth()-this.insetBottom:t=>a[t]-this.insetBottom:f-m-this.insetBottom).call(Wt,"stroke",c&&(t=>c[t])).call(S(s)))).node()}}class Ae extends d{constructor(t,{x1:e,x2:n,y:r,title:o,stroke:i,inset:a=0,insetRight:l=a,insetLeft:s=a,...c}={}){const[u,f]=B(i,"currentColor");super(t,[{name:"y",value:r,scale:"y",optional:!0},{name:"x1",value:e,scale:"x",optional:!0},{name:"x2",value:n,scale:"x",optional:!0},{name:"title",value:o,optional:!0},{name:"stroke",value:u,scale:"color",optional:!0}],c),It(this,{stroke:f,...c}),this.insetRight=v(l),this.insetLeft=v(s)}render(t,{x:n,y:r},{y:o,x1:i,x2:a,title:s,stroke:c},{width:u,height:f,marginTop:d,marginRight:p,marginLeft:h,marginBottom:m}){const y=l(t,o,i,a);return e.create("svg:g").call(Ut,this).call(Zt,null,o&&r,0,.5).call((t=>t.selectAll("line").data(y).join("line").call(qt,this).attr("x1",i?t=>i[t]+this.insetLeft:h+this.insetLeft).attr("x2",a?n.bandwidth?t=>a[t]+n.bandwidth()-this.insetRight:t=>a[t]-this.insetRight:u-p-this.insetRight).attr("y1",o?t=>o[t]:(d+f-m)/2).attr("y2",o?t=>o[t]:(d+f-m)/2).call(Wt,"stroke",c&&(t=>c[t])).call(S(s)))).node()}}function ze(t,e,n){if(void 0===t){if(void 0===e){if(void 0!==n)return[0,n]}else if(void 0===n)return[0,e]}else{if(void 0===e)return void 0===n?[0,t]:[t,n];if(void 0===n)return[t,e]}return[e,n]}class Se extends d{constructor(t,{x:e,y:n,text:r=y,title:o,fill:i,fillOpacity:a,textAnchor:l,fontFamily:s,fontSize:c,fontStyle:u,fontVariant:f,fontWeight:d,dx:p,dy:h="0.32em",rotate:m,...g}={}){const[v,k]=B(i,"currentColor"),[b,w]=M(a),[O,R]=M(m,0),[$,C]=M(c);super(t,[{name:"x",value:e,scale:"x",optional:!0},{name:"y",value:n,scale:"y",optional:!0},{name:"fontSize",value:V($),optional:!0},{name:"rotate",value:V(O),optional:!0},{name:"text",value:r},{name:"title",value:o,optional:!0},{name:"fill",value:v,scale:"color",optional:!0},{name:"fillOpacity",value:b,scale:"opacity",optional:!0}],g),It(this,{fill:k,fillOpacity:w,...g}),this.rotate=R,this.textAnchor=x(l),this.fontFamily=x(s),this.fontSize=x(C),this.fontStyle=x(u),this.fontVariant=x(f),this.fontWeight=x(d),this.dx=x(p),this.dy=x(h)}render(t,{x:n,y:r},{x:o,y:i,rotate:s,text:c,title:u,fill:f,fillOpacity:d,fontSize:p},{width:h,height:m,marginTop:y,marginRight:g,marginBottom:x,marginLeft:v}){const{rotate:k}=this,b=l(t,o,i,f,d,s).filter((t=>a(c[t]))),w=(v+h-g)/2,O=(y+m-x)/2;return e.create("svg:g").call(Ye,this).call(Zt,n,r,.5,.5).call((t=>t.selectAll().data(b).join("text").call(Pe,this).call(s?t=>t.attr("transform",o&&i?t=>`translate(${o[t]},${i[t]}) rotate(${s[t]})`:o?t=>`translate(${o[t]},${O}) rotate(${s[t]})`:i?t=>`translate(${w},${i[t]}) rotate(${s[t]})`:t=>`translate(${w},${O}) rotate(${s[t]})`):k?t=>t.attr("transform",o&&i?t=>`translate(${o[t]},${i[t]}) rotate(${k})`:o?t=>`translate(${o[t]},${O}) rotate(${k})`:i?t=>`translate(${w},${i[t]}) rotate(${k})`:`translate(${w},${O}) rotate(${k})`):t=>t.attr("x",o?t=>o[t]:w).attr("y",i?t=>i[t]:O)).call(Wt,"fill",f&&(t=>f[t])).call(Wt,"fill-opacity",d&&(t=>d[t])).call(Wt,"font-size",p&&(t=>p[t])).text((t=>c[t])).call(S(u)))).node()}}function Ye(t,e){Ut(t,e),Wt(t,"text-anchor",e.textAnchor),Vt(t,"font-family",e.fontFamily),Vt(t,"font-size",e.fontSize),Vt(t,"font-style",e.fontStyle),Vt(t,"font-variant",e.fontVariant),Vt(t,"font-weight",e.fontWeight)}function Pe(t,e){qt(t,e),Wt(t,"dx",e.dx),Wt(t,"dy",e.dy)}class Ne extends d{constructor(t,e,{title:n,stroke:r,strokeOpacity:o,...i}={}){const[a,l]=B(r,"currentColor"),[s,c]=M(o);super(t,[...e,{name:"title",value:n,optional:!0},{name:"stroke",value:a,scale:"color",optional:!0},{name:"strokeOpacity",value:s,scale:"opacity",optional:!0}],i),It(this,{stroke:l,strokeOpacity:c,...i})}render(t,n,r,o){const{x:i,y:a,title:s,stroke:c,strokeOpacity:u}=r,f=l(t,i,a,c,u);return e.create("svg:g").call(Ut,this).call(this._transform,n).call((t=>t.selectAll("line").data(f).join("line").call(qt,this).attr("x1",this._x1(n,r,o)).attr("x2",this._x2(n,r,o)).attr("y1",this._y1(n,r,o)).attr("y2",this._y2(n,r,o)).call(Wt,"stroke",c&&(t=>c[t])).call(Wt,"stroke-opacity",u&&(t=>u[t])).call(S(s)))).node()}}class _e extends Ne{constructor(t,{x:e,y:n,inset:r=0,insetTop:o=r,insetBottom:i=r,...a}={}){super(t,[{name:"x",value:e,scale:"x"},{name:"y",value:n,scale:"y",type:"band",optional:!0}],a),this.insetTop=v(o),this.insetBottom=v(i)}_transform(t,{x:e}){t.call(Zt,e,null,.5,0)}_x1(t,{x:e}){return t=>e[t]}_x2(t,{x:e}){return t=>e[t]}_y1(t,{y:e},{marginTop:n}){return e?t=>e[t]+this.insetTop:n+this.insetTop}_y2({y:t},{y:e},{height:n,marginBottom:r}){return e?n=>e[n]+t.bandwidth()-this.insetBottom:n-r-this.insetBottom}}class je extends Ne{constructor(t,{x:e,y:n,inset:r=0,insetRight:o=r,insetLeft:i=r,...a}={}){super(t,[{name:"y",value:n,scale:"y"},{name:"x",value:e,scale:"x",type:"band",optional:!0}],a),this.insetRight=v(o),this.insetLeft=v(i)}_transform(t,{y:e}){t.call(Zt,null,e,0,.5)}_x1(t,{x:e},{marginLeft:n}){return e?t=>e[t]+this.insetLeft:n+this.insetLeft}_x2({x:t},{x:e},{width:n,marginRight:r}){return e?n=>e[n]+t.bandwidth()-this.insetRight:n-r-this.insetRight}_y1(t,{y:e}){return t=>e[t]}_y2(t,{y:e}){return t=>e[t]}}function Ge(t,e,{data:n=Ue,...r}={},o={}){n=De(n,g),r=Ee(r,o);const[i,a]=E(t),[l,s]=E(e),{z:c,fill:u,stroke:f,...d}=o,[p,m]=E(c),[y]=B(u),[x]=B(f),[v=u,k]=E(y),[b=f,w]=E(x);return{..."z"in o&&{z:p||c},..."fill"in o&&{fill:v||u},..."stroke"in o&&{stroke:b||f},...F(d,((o,i)=>{const l=h(o,t),u=h(o,e),f=h(o,c),d=h(o,y),p=h(o,x),g=Xe(r,f,d,p),v=[],b=[],O=l&&a([]),R=u&&s([]),B=f&&m([]),M=d&&k([]),$=p&&w([]);let C=0;for(const t of r)t.initialize(o);for(const t of i){const e=[];for(const e of r)e.scope("facet",t);for(const[,i]of Fe(t,g))for(const[t,a]of Fe(i,u))for(const[i,s]of Fe(a,l)){e.push(C++),b.push(n.reduce(s,o)),l&&O.push(i),u&&R.push(t),f&&B.push(f[s[0]]),d&&M.push(d[s[0]]),p&&$.push(p[s[0]]);for(const t of r)t.reduce(s)}v.push(e)}return{data:b,facets:v}})),...i&&{x:i},...l&&{y:l},...Object.fromEntries(r.map((({name:t,output:e})=>[t,e])))}}function Ee(t,e){return Object.entries(t).map((([t,n])=>{const r=_(t,e),o=De(n,r),[i,a]=j(G(r,o.label));let l,s,c;return{name:t,output:i,initialize(t){l=void 0===r?t:h(t,r),s=a([]),"data"===o.scope&&(c=o.reduce(P(t),l))},scope(t,e){o.scope===t&&(c=o.reduce(e,l))},reduce(t){s.push(o.reduce(t,l,c))}}}))}function Fe(t,n){return n?e.sort(e.group(t,(t=>n[t])),b):[[,t]]}function De(t,n){if(t&&"function"==typeof t.reduce)return t;if("function"==typeof t)return r=t,{reduce:(t,e)=>r(N(e,t))};var r;switch((t+"").toLowerCase()){case"first":return qe;case"last":return We;case"count":return Ve;case"sum":return null==n?Ve:Ze;case"proportion":return He(n,"data");case"proportion-facet":return He(n,"facet");case"deviation":return Ie(e.deviation);case"min":return Ie(e.min);case"max":return Ie(e.max);case"mean":return Ie(e.mean);case"median":return Ie(e.median);case"variance":return Ie(e.variance)}throw new Error("invalid reduce")}function Xe(t,e,n,r){return function(...t){for(const e of t)if(void 0!==e)return e}(t.some((t=>"z"===t.name))?void 0:e,t.some((t=>"fill"===t.name))?void 0:n,t.some((t=>"stroke"===t.name))?void 0:r)}function Ie(t){return{reduce:(e,n)=>t(e,(t=>n[t]))}}const Ue={reduce:(t,e)=>N(e,t)},qe={reduce:(t,e)=>e[t[0]]},We={reduce:(t,e)=>e[t[t.length-1]]},Ve={label:"Frequency",reduce:t=>t.length},Ze=Ie(e.sum);function He(t,n){return null==t?{scope:n,label:"Frequency",reduce:(t,e,n=1)=>t.length/n}:{scope:n,reduce:(t,n,r=1)=>e.sum(t,(t=>n[t]))/r}}function Je(t,e,n,r,{data:o=Ue,...i}={},a={}){t=Qe(t),e=Qe(e),o=De(o,g),i=Ee(i,a),null!=n&&en(i,"x","x1","x2")&&(n=null),null!=r&&en(i,"y","y1","y2")&&(r=null);const[l,s]=E(t),[c,u]=E(t),[f,d]=E(e),[p,m]=E(e),[y,x]=null!=n?[n,"x"]:null!=r?[r,"y"]:[],[v,k]=E(y),{x:b,y:w,z:O,fill:R,stroke:M,...$}=a,[C,L]=E(O),[T]=B(R),[A]=B(M),[z=R,S]=E(T),[Y=M,P]=E(A);return{..."z"in a&&{z:C||O},..."fill"in a&&{fill:z||R},..."stroke"in a&&{stroke:Y||M},...F($,((n,r)=>{const a=h(n,y),l=h(n,O),c=h(n,T),f=h(n,A),p=Xe(i,l,c,f),g=[],x=[],v=a&&k([]),b=l&&L([]),w=c&&S([]),R=f&&P([]),B=t?t(n):[[,,t=>t]],M=e?e(n):[[,,t=>t]],$=t&&s([]),C=t&&u([]),z=e&&d([]),Y=e&&m([]);let N=0;for(const t of i)t.initialize(n);for(const t of r){const e=[];for(const e of i)e.scope("facet",t);for(const[,r]of Fe(t,p))for(const[t,s]of Fe(r,a))for(const[r,u,d]of B){const p=d(s);if(0!==p.length)for(const[s,d,h]of M){const m=h(p);if(0!==m.length){e.push(N++),x.push(o.reduce(m,n)),a&&v.push(t),l&&b.push(l[m[0]]),c&&w.push(c[m[0]]),f&&R.push(f[m[0]]),$&&($.push(r),C.push(u)),z&&(z.push(s),Y.push(d));for(const t of i)t.reduce(m)}}}g.push(e)}return{data:x,facets:g}})),...l?{x1:l,x2:c,x:D(l,c)}:{x:b},...f?{y1:f,y2:p,y:D(f,p)}:{y:w},...v&&{[x]:v},...Object.fromEntries(i.map((({name:t,output:e})=>[t,e])))}}function Ke(t,{cumulative:n,domain:r,thresholds:o}={},i){return void 0===(t={...X(t)}).domain&&(t.domain=r),void 0===t.cumulative&&(t.cumulative=n),void 0===t.thresholds&&(t.thresholds=o),void 0===t.value&&(t.value=i),t.thresholds=function(t=e.thresholdScott){if("string"==typeof t){switch(t.toLowerCase()){case"freedman-diaconis":return e.thresholdFreedmanDiaconis;case"scott":return e.thresholdScott;case"sturges":return e.thresholdSturges}throw new Error("invalid thresholds")}return t}(t.thresholds),t}function Qe(t){if(null==t)return;const{value:n,cumulative:r,domain:o=e.extent,thresholds:i}=t,a=t=>{const a=h(t,n),l=e.bin().value((t=>a[t]));if(J(a)){let[t,n]="function"==typeof o?o(a):o,r="function"!=typeof i||tn(i)?i:i(a,t,n);"number"==typeof r&&(r=e.utcTickInterval(t,n,r)),tn(r)&&(o===e.extent&&(t=r.floor(t),n=r.ceil(new Date(+n+1))),r=r.range(t,n)),l.thresholds(r).domain([t,n])}else l.thresholds(i).domain(o);let s=l(P(t)).map(nn);return r&&(s=(r<0?s.reverse():s).map(rn)),s.filter(an).map(on)};return a.label=G(n),a}function tn(t){return!!t&&"function"==typeof t.range}function en(t,...e){for(const{name:n}of t)if(e.includes(n))return!0;return!1}function nn(t){return[t,new Set(t)]}function rn([t],e,n){return[t,{get size(){for(let t=0;t<=e;++t)if(n[t][1].size)return 1;return 0},has(t){for(let r=0;r<=e;++r)if(n[r][1].has(t))return!0;return!1}}]}function on([{x0:t,x1:e},n]){return[t,e,t=>t.filter(n.has,n)]}function an([,{size:t}]){return t>0}function ln(t,e,n){return void 0===t&&void 0===e&&void 0===n?Xt?[1,0]:[.5,.5]:[e,n]}function sn(t,e={}){return un(Object.fromEntries(["x","x1","x2"].filter((t=>null!=e[t])).map((e=>[e,t]))),e)}function cn(t,e={}){return un(Object.fromEntries(["y","y1","y2"].filter((t=>null!=e[t])).map((e=>[e,t]))),e)}function un(t={},n={}){const r=z(n),o=Object.entries(t).map((([t,e])=>{const r=_(t,n);if(null==r)throw new Error(`missing channel: ${t}`);const[o,i]=j(r);return{key:t,input:r,output:o,setOutput:i,map:fn(e)}}));return{...F(n,((t,n)=>{const i=h(t,r),a=o.map((({input:e})=>h(t,e))),l=o.map((({setOutput:e})=>e(new Array(t.length))));for(const t of n)for(const n of i?e.group(t,(t=>i[t])).values():[t])o.forEach((({map:t},e)=>t.map(n,a[e],l[e])));return{data:t,facets:n}})),...Object.fromEntries(o.map((({key:t,output:e})=>[t,e])))}}function fn(t){if(t&&"function"==typeof t.map)return t;if("function"==typeof t)return e=t,{map(t,n,r){const o=e(N(n,t));if(o.length!==t.length)throw new Error("mismatched length");for(let e=0,n=t.length;e<n;++e)r[t[e]]=o[e]}};var e;switch((t+"").toLowerCase()){case"cumsum":return dn}throw new Error("invalid map")}const dn={map(t,e,n){let r=0;for(const o of t)n[o]=r+=e[o]}};function pn(t){if(void 0===t)return yn;if("function"==typeof t)return hn(((e,n)=>t(N(n,e))));switch((t+"").toLowerCase()){case"first":return yn;case"last":return gn;case"mean":return xn;case"median":return vn;case"sum":return kn;case"extent":return mn}throw new Error("invalid basis")}function hn(t){return{map(e,n,r){const o=+t(e,n);for(const t of e)r[t]=null===n[t]?NaN:n[t]/o}}}const mn={map(t,n,r){const[o,i]=e.extent(t,(t=>n[t])),a=i-o;for(const e of t)r[e]=null===n[e]?NaN:(n[e]-o)/a}},yn=hn(((t,e)=>{for(let n=0;n<t.length;++n){const r=e[t[n]];if(o(r))return r}})),gn=hn(((t,e)=>{for(let n=t.length-1;n>=0;--n){const r=e[t[n]];if(o(r))return r}})),xn=hn(((t,n)=>e.mean(t,(t=>n[t])))),vn=hn(((t,n)=>e.median(t,(t=>n[t])))),kn=hn(((t,n)=>e.sum(t,(t=>n[t]))));function bn(t,n,r){if(!((t=Math.floor(t))>0))throw new Error("invalid k");return function(t="mean"){if("string"==typeof t)switch(t.toLowerCase()){case"deviation":return wn(e.deviation);case"max":return wn(e.max);case"mean":return Rn;case"median":return wn(e.median);case"min":return wn(e.min);case"sum":return On;case"variance":return wn(e.variance);case"difference":return Bn;case"ratio":return Mn}if("function"!=typeof t)throw new Error("invalid reduce");return wn(t)}(n)(t,function(t="centered",e){switch((t+"").toLowerCase()){case"centered":return e-1>>1;case"leading":return 0;case"trailing":return e-1}throw new Error("invalid shift")}(r,t))}function wn(t){return(e,n)=>({map(r,o,i){const a=Float64Array.from(r,(t=>null===o[t]?NaN:o[t]));let l=0;for(let t=0;t<e-1;++t)isNaN(a[t])&&++l;for(let o=0,s=r.length-e+1;o<s;++o)isNaN(a[o+e-1])&&++l,i[r[o+n]]=0===l?t(a.subarray(o,o+e)):NaN,isNaN(a[o])&&--l}})}function On(t,e){return{map(n,r,o){let i=0,a=0;for(let e=0;e<t-1;++e){const t=r[n[e]];null===t||isNaN(t)?++i:a+=+t}for(let l=0,s=n.length-t+1;l<s;++l){const s=r[n[l]],c=r[n[l+t-1]];null===c||isNaN(c)?++i:a+=+c,o[n[l+e]]=0===i?a:NaN,null===s||isNaN(s)?--i:a-=+s}}}}function Rn(t,e){const n=On(t,e);return{map(r,o,i){n.map(r,o,i);for(let n=0,o=r.length-t+1;n<o;++n)i[r[n+e]]/=t}}}function Bn(t,e){return{map(n,r,o){for(let i=0,a=n.length-t;i<a;++i){const a=r[n[i]],l=r[n[i+t-1]];o[n[i+e]]=null===a||null===l?NaN:l-a}}}}function Mn(t,e){return{map(n,r,o){for(let i=0,a=n.length-t;i<a;++i){const a=r[n[i]],l=r[n[i+t-1]];o[n[i+e]]=null===a||null===l?NaN:l/a}}}}function*$n(t){yield t[0]}function*Cn(t){yield t[t.length-1]}function*Ln(t,n){yield e.least(t,(t=>n[t]))}function*Tn(t,n){yield e.greatest(t,(t=>n[t]))}function An(t,n,r){const o=z(r);return F(r,((r,i)=>{const a=h(r,o),l=h(r,n),s=[];for(const n of i){const r=[];for(const o of a?e.group(n,(t=>a[t])).values():[n])for(const e of t(o,l))r.push(e);s.push(r)}return{data:r,facets:s}}))}t.Area=ke,t.BarX=we,t.BarY=Oe,t.Cell=Re,t.Dot=Be,t.Frame=Me,t.Line=$e,t.Link=Ce,t.Mark=d,t.Rect=Le,t.RuleX=Te,t.RuleY=Ae,t.Text=Se,t.TickX=_e,t.TickY=je,t.area=function(t,e){return new ke(t,e)},t.areaX=function(t,{y:e=y,...n}={}){return new ke(t,oe({...n,y1:e,y2:void 0}))},t.areaY=function(t,{x:e=y,...n}={}){return new ke(t,ie({...n,x1:e,x2:void 0}))},t.barX=function(t,e){return new we(t,oe(e))},t.barY=function(t,e){return new Oe(t,ie(e))},t.bin=function(t,{inset:e,insetTop:n,insetRight:r,insetBottom:o,insetLeft:i,...a}={}){const{x:l,y:s}=function(t={}){let{x:e,y:n}=t;return e=Ke(e,t),n=Ke(n,t),[e.value,n.value]=A(e.value,n.value),{x:e,y:n}}(a);return[n,o]=ln(e,n,o),[i,r]=ln(e,i,r),Je(l,s,null,null,t,{inset:e,insetTop:n,insetRight:r,insetBottom:o,insetLeft:i,...a})},t.binX=function(t,{inset:e,insetLeft:n,insetRight:r,...o}={}){let{x:i,y:a}=o;return i=Ke(i,o,g),[n,r]=ln(e,n,r),Je(i,null,null,a,t,{inset:e,insetLeft:n,insetRight:r,...o})},t.binY=function(t,{inset:e,insetTop:n,insetBottom:r,...o}={}){let{x:i,y:a}=o;return a=Ke(a,o,g),[n,r]=ln(e,n,r),Je(null,a,i,null,t,{inset:e,insetTop:n,insetBottom:r,...o})},t.cell=function(t,{x:e,y:n,...r}={}){return[e,n]=A(e,n),new Re(t,{...r,x:e,y:n})},t.cellX=function(t,{x:e=y,fill:n,stroke:r,...o}={}){return void 0===n&&void 0===B(r)[0]&&(n=g),new Re(t,{...o,x:e,fill:n,stroke:r})},t.cellY=function(t,{y:e=y,fill:n,stroke:r,...o}={}){return void 0===n&&void 0===B(r)[0]&&(n=g),new Re(t,{...o,y:e,fill:n,stroke:r})},t.dot=function(t,{x:e,y:n,...r}={}){return[e,n]=A(e,n),new Be(t,{...r,x:e,y:n})},t.dotX=function(t,{x:e=g,...n}={}){return new Be(t,{...n,x:e})},t.dotY=function(t,{y:e=g,...n}={}){return new Be(t,{...n,y:e})},t.formatIsoDate=n,t.formatMonth=function(t="en-US",e="short"){const n=new Intl.DateTimeFormat(t,{timeZone:"UTC",month:e});return t=>{if(null!=t&&!isNaN(t=new Date(Date.UTC(2e3,+t))))return n.format(t)}},t.formatWeekday=function(t="en-US",e="short"){const n=new Intl.DateTimeFormat(t,{timeZone:"UTC",weekday:e});return t=>{if(null!=t&&!isNaN(t=new Date(Date.UTC(2001,0,+t))))return n.format(t)}},t.frame=function(t){return new Me(t)},t.group=function(t,e={}){let{x:n,y:r}=e;if([n,r]=A(n,r),null==n)throw new Error("missing channel: x");if(null==r)throw new Error("missing channel: y");return Ge(n,r,t,e)},t.groupX=function(t,e={}){const{x:n=g}=e;if(null==n)throw new Error("missing channel: x");return Ge(n,null,t,e)},t.groupY=function(t,e={}){const{y:n=g}=e;if(null==n)throw new Error("missing channel: y");return Ge(null,n,t,e)},t.groupZ=function(t,e){return Ge(null,null,t,e)},t.line=function(t,{x:e,y:n,...r}={}){return[e,n]=A(e,n),new $e(t,{...r,x:e,y:n})},t.lineX=function(t,{x:e=g,y:n=y,...r}={}){return new $e(t,{...r,x:e,y:n})},t.lineY=function(t,{x:e=y,y:n=g,...r}={}){return new $e(t,{...r,x:e,y:n})},t.link=function(t,e){return new Ce(t,e)},t.map=un,t.mapX=sn,t.mapY=cn,t.normalizeX=function({basis:t,...e}={}){return sn(pn(t),e)},t.normalizeY=function({basis:t,...e}={}){return cn(pn(t),e)},t.plot=Kt,t.rect=function(t,e){return new Le(t,e)},t.rectX=function(t,e){return new Le(t,oe(e))},t.rectY=function(t,e){return new Le(t,ie(e))},t.ruleX=function(t,{x:e=g,y:n,y1:r,y2:o,...i}={}){return[r,o]=ze(n,r,o),new Te(t,{...i,x:e,y1:r,y2:o})},t.ruleY=function(t,{y:e=g,x:n,x1:r,x2:o,...i}={}){return[r,o]=ze(n,r,o),new Ae(t,{...i,y:e,x1:r,x2:o})},t.selectFirst=function(t){return An($n,void 0,t)},t.selectLast=function(t){return An(Cn,void 0,t)},t.selectMaxX=function(t={}){return An(Tn,t.x,t)},t.selectMaxY=function(t={}){return An(Tn,t.y,t)},t.selectMinX=function(t={}){return An(Ln,t.x,t)},t.selectMinY=function(t={}){return An(Ln,t.y,t)},t.stackX=ne,t.stackX1=function({y1:t,y:e=t,x:n,...r}={}){const[o,i,a]=ae(e,n,"x",r);return{y1:t,y:i,x:a,...o}},t.stackX2=function({y1:t,y:e=t,x:n,...r}={}){const[o,i,,a]=ae(e,n,"x",r);return{y1:t,y:i,x:a,...o}},t.stackY=re,t.stackY1=function({x1:t,x:e=t,y:n,...r}={}){const[o,i,a]=ae(e,n,"y",r);return{x1:t,x:i,y:a,...o}},t.stackY2=function({x1:t,x:e=t,y:n,...r}={}){const[o,i,,a]=ae(e,n,"y",r);return{x1:t,x:i,y:a,...o}},t.text=function(t,{x:e,y:n,...r}={}){return[e,n]=A(e,n),new Se(t,{...r,x:e,y:n})},t.textX=function(t,{x:e=g,...n}={}){return new Se(t,{...n,x:e})},t.textY=function(t,{y:e=g,...n}={}){return new Se(t,{...n,y:e})},t.tickX=function(t,{x:e=g,...n}={}){return new _e(t,{...n,x:e})},t.tickY=function(t,{y:e=g,...n}={}){return new je(t,{...n,y:e})},t.valueof=h,t.version="0.1.0",t.windowX=function({k:t,reduce:e,shift:n,...r}={}){return sn(bn(t,e,n),r)},t.windowY=function({k:t,reduce:e,shift:n,...r}={}){return cn(bn(t,e,n),r)},Object.defineProperty(t,"__esModule",{value:!0})}));
